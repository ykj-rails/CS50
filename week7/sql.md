# [Week7 SQL](https://cs50.jp/x/2022/week7/)

## SQL

- データベースを操作するための言語
- データベースはテーブルの集合であり、テーブルは行と列の集合

## CRUD

データベース管理システムに必要とされる4つの主要な機能

- CREATE
- READ
- UPDATE
- DELETE

## SQLite

- 非常に軽量なSQL言語
- iPhoneやAndroidデバイスで一般的に使われているSQLのバージョン
- ファイルの拡張子は`.db`

### テーブルから列を選択

- 慣習的にSQLの特殊なキーワードは大文字、列名とテーブル名は小文字にする

```sql
SELECT columns FROM table;
```

### SQLビルトイン関数

```
AVG
COUNT
DISTINCT
LOWER
MAX
MIN
UPPER
```

## 結合テーブル

- 2つの整数列を使って2つのテーブルを論理的に結合する

## INDEX

- メモリ上にインデックスを作成することで計算時間を高速化することができる
- 全てをインデックス化することはスペースの問題でよろしくない
- 適切な変曲点を見つけることは設計のプロセスの一部であり、必要
- Btreeはインデックスの一種で、データを効率的に検索するためのデータ構造

## relational database

- データベースのテーブル間に関係がある場合、それをリレーショナルデータベースと呼ぶ
- 例えば、ユーザーとそのユーザーが投稿した記事がある場合、ユーザーと記事のテーブルをリレーショナルデータベースと呼ぶ

## SQL injection attacks

- ユーザーがSQLのように見えるものを入力すると、データベースが意図していないこと、例えばユーザーをログインさせるようなことができる
- データの削除や更新も可能な場合がある
- これを防ぐためには、ユーザーが入力したデータをエスケープする必要がある

## race condition

- WEBアプリケーションでDBを操作する何かしらのアクションが同時に起こってしまった場合の問題
- X（旧Twitter）ではツイートやリツイートなどで頻繁に起こっていた問題
- Transactionで解決できる
  - 何かを一気にやらなければいけない時、まずトランザクションを開始し、その処理を行い、最後にトランザクションをコミットする
  - Transactionの間に実行するコードはパフォーマンスの観点から素早く終わらせる必要がある

## CSV

- CSVはフラットファイル・データベースと呼ばれる

## 感想

講義の序盤1時間を使ってPythonでCSVファイルを扱い、Pythonで頑張りながらデータのソートやデータを抽出する辞書プログラムを書いていたが、より生産性的かつ効率的にデータを保存、操作、変更、取得する上でSQLを使って行こうぜという話だった。

PythonとSQLを組み合わせることで両方の長所を活かし、コードをの記述を少なくできる。

個人開発していた時期もあったので大体は理解できる話であったが、仕事でSQLを書くようなこともないので具体的なSQLクエリを書けるかといば微妙ではあるが、そこまでの複雑性は感じなかったので、求められるシチュエーションにおいてキャッチアップすれば良いかなと思った。

個人的にはrace conditionの話とTransactionの関係がクリアになったのが良かった。