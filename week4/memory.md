# [Week4 Memory](https://cs50.jp/x/2022/week4/)

## 16進数

- 0からFまでの記号を使って0から15までを数える方法

## pointers

- ポイントとは、ある値のアドレス、つまりある値の位置、その値が格納されている特定のバイトを格納する変数

```c
int main(void) {
  int n = 50;
  int *p = &n; // nのアドレスを取得
  printf("%p\n", p); // 0x7ffda0a4767c
  printf("%i\n", *p); // 50
}
```

- ポインタを宣言するにはアドレスを格納する値の型を指定し、それが単なる従来のint型ではなく、ポインタであることを示すために`＊`を使用する
- 変数名の前に`*`を付けるとポインタ型の変数の箱を用意する
- C言語では、変数に`&`を付けると変数のアドレスを意味することになる

```c
// 変数sとsの最初の文字「H」が指すアドレスは同じ

int main(void) {
  string s = "HI!";
  char *p = &s[0];
  printf("%p\n", p); // 0x402004
  printf("%p\n", s); // 0x402004
}
```

- 文字列はコンピュータのメモリ上ではポインタの変数で表され、その内部には文字列の最初の文字のアドレスが格納されている

```c
// 文字列のアドレスを取得するサンプル

int main(void) {
  char *s = "HI!";
  printf("%p\n", s);     // 0x402004
  printf("%p\n", &s[0]); // 0x402004
  printf("%p\n", &s[1]); // 0x402005
  printf("%p\n", &s[2]); // 0x402006
  printf("%p\n", &s[3]); // 0x402007
}
```

## pointer arithmetic

- ポインタを16進数、10進数に関係なく数字として扱う

```c
int main(void) {
  char *s = "HI!";
  printf("%c\n", *s);       // H
  printf("%c\n", *(s + 1)); // I
  printf("%c\n", *(s + 2)); // !
}
```

```c
// s と tは同じアドレスを指す

int main(void) {
  string s = "hi!";
  string t = s;

  t[0] = toupper(t[0]);

  printf("s: %s\n", s); // H
  printf("t: %s\n", t); // H
}
```

- tにsをコピーした時、値を参照するアドレスがコピーされるため、値を重複してメモリに保存しない

## JPEG

- 16進数で書かれた3つのバイトである
- 例：`0xFF 0xD8 0xFF`

## 学んだこと

- メモリのアドレスは実行するたびに変わる
- 最近のポインタは通常8バイト（64ビット）を使用する
  - 昔は32ビットが標準だった
- 文字列は効率化のためにコンピュータのメモリの別の場所に保存されることが多い
  - intやfloatなどの他の値は慣習的にメモリのより後ろに格納される
- メモリは使ったら解放されるべき

## 感想

今までメモリに関してあまり意識したことがなかったが、ざっくりとメモリの内部的なイメージがついた

メモリの慣習的にははただ単に空いているところに置くというランダムな使い方ではなく、実際にはメモリにさまざま部分を目的に応じて使い分けており、値をコピーする際には、値を重複してメモリに保存するのではなく、値を参照するアドレスをコピーすることでメモリの効率化を図っている

C言語の`malloc`と`free`を使用して動的メモリの確保とメモリの解放についてデモンストレーションがあり、メモリの解放を忘れるとメモリリークが発生することがあることがわかった

普段書き馴染みのあるJSではメモリの[管理](https://developer.mozilla.org/ja/docs/Web/JavaScript/Memory_management)がどうなっているのか気になったので調べてみた

> C のような低水準言語には、malloc() や free() のような低水準のメモリー管理プリミティブがあります。これに対して JavaScript では、オブジェクトを> 作成するときにメモリーを自動的に確保し、使用しなくなったらメモリーを解放します

とあるように、JSでは必要なメモリの割り当てと解放については暗黙的に行われているよう

